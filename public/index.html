<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/xeicon@2.3.3/xeicon.min.css">
    <title>Today Diary</title>
</head>
<body>
    <section class="login-page">
        <div class="login">
            <div class="login-logo">
                <img src="img/Today diary logo white.png" alt="">
                <h1>오늘 일기</h1>
                <span>당신의 오늘을 기록하세요</span>
            </div>
            <form action class="login-form">
                <h1>Login</h1>
                <span class="login-field"><i class="xi-user-o"></i>사용자 아이디</span>
                <input type="text" id="user-id" placeholder="아이디를 입력하세요">
                <span class="login-field"><i class="xi-lock-o"></i>사용자 비밀번호</span>
                <input type="password" id="user-password" placeholder="비밀번호를 입력하세요">
                <input type="button" id="sub-btn" value="Login">
                <div class="sign-up">
                    <span>아직 계정이 없으신가요?</span>
                    <a href="register.html">가입하기</a>
                </div>
            </form>
        </div>
    </section>

    <script defer src="/__/firebase/9.6.8/firebase-app.js"></script>
    <script defer src="/__/firebase/9.6.8/firebase-auth.js"></script>
    <script defer src="/__/firebase/9.6.8/firebase-database.js"></script>
    <script defer src="/__/firebase/9.6.8/firebase-firestore.js"></script>
    <script defer src="/__/firebase/9.6.8/firebase-storage.js"></script> 
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
          apiKey: "AIzaSyCg8ul1Mqi0UIXY3nF6vwnkHrXkO-I5DPM",
          authDomain: "firediay.firebaseapp.com",
          databaseURL: "https://firediay-default-rtdb.firebaseio.com",
          projectId: "firediay",
          storageBucket: "firediay.appspot.com",
          messagingSenderId: "565944170521",
          appId: "1:565944170521:web:b258542056bf60158d1288"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        import{ getDatabase, ref, set, child,get } from "https://www.gstatic.com/firebasejs/9.6.8/firebase-database.js"
        const db=getDatabase();

        // 
        const name=document.getElementById('user-id');
        const pass=document.getElementById('user-password');
        const submit=document.getElementById('sub-btn');
        // 

        function AuthenticateUser(){
            const dbref=ref(db);
            get(child(dbref,"UsersList/" + name.value)).then((snapshot)=>{
                if(snapshot.exists()){
                    let dbpass=snapshot.val().password;
                    if(dbpass==pass.value){
                        login(snapshot.val());
                    }
                    else{
                        alert("회원정보가 없습니다")
                    }
                }
                else{
                    alert("아이디 혹은 패스워드가 틀렸습니다")
                }
            });
        }
            function login(user){
                localStorage.setItem('user',JSON.stringify(user));
                window.location="main.html";
            }
        
        submit.addEventListener('click',AuthenticateUser);
    </script>
</body>
</html>